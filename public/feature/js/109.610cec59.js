"use strict";(self["webpackChunkfeature"]=self["webpackChunkfeature"]||[]).push([[109],{3109:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});a(90327);var n=a(63773),u=a(45006),s=a(20440),r=a(23294),c=a(86148);const o={class:"account"},l=["src"];var i={__name:"index",setup(e){const t=(0,r.KR)(window.rubick.dbStorage.getItem("rubick-user-info")),a=(0,r.KR)(""),i=(0,s.Ak)(),d=(0,r.KR)(!1),v=()=>{d.value=!0,a.value||t.value||c.A.getScanCode({scene:i}).then(e=>{a.value=`data:image/png;base64,${e.dataUrl}`})};let g=null;return(0,u.wB)([d],()=>{d.value?g=setInterval(()=>{c.A.checkLoginStatus({scene:i}).then(e=>{console.log(e),e.openId&&(window.rubick.dbStorage.setItem("rubick-user-info",e),t.value=e,n["default"].success("登录成功！"),d.value=!1,clearInterval(g),g=null)})},2e3):(clearInterval(g),g=null)}),(e,n)=>{const s=(0,u.g2)("a-button"),r=(0,u.g2)("a-result"),c=(0,u.g2)("a-modal");return(0,u.uX)(),(0,u.CE)("div",o,[t.value?(0,u.Q3)("",!0):((0,u.uX)(),(0,u.Wv)(r,{key:0,title:"请先登录","sub-title":"用户暂未登录，无法体验更多设置"},{extra:(0,u.k6)(()=>[(0,u.bF)(s,{type:"primary",onClick:v},{default:(0,u.k6)(()=>[...n[1]||(n[1]=[(0,u.eW)("使用微信小程序登录",-1)])]),_:1})]),_:1})),(0,u.bF)(c,{visible:d.value,"onUpdate:visible":n[0]||(n[0]=e=>d.value=e),footer:null},{default:(0,u.k6)(()=>[(0,u.bF)(r,{title:"请使用微信扫码登录!","sub-title":"使用微信扫描上面的 rubick 小程序二维码进行授权登录"},{icon:(0,u.k6)(()=>[(0,u.Lk)("img",{width:"200",src:a.value},null,8,l)]),_:1})]),_:1},8,["visible"])])}}},d=a(30188);const v=(0,d.A)(i,[["__scopeId","data-v-b6844020"]]);var g=v},20440:function(e,t,a){a.d(t,{Ak:function(){return n}});let n=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>(t&=63,e+=t<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_",e),"")},86148:function(e,t,a){var n=a(58398),u=a.n(n);const s=u().create({baseURL:"https://ruck.jiahe.host/api/"});t.A={async getScanCode({scene:e}){const t=await s.get("/users/getScanCode",{params:{scene:e}});return t.data},async checkLoginStatus({scene:e}){const t=await s.post("/users/checkLoginStatus",{scene:e});return t.data},async getUserInfo({openId:e}){const t=await s.post("/users/getUserInfo",{openId:e});return t.data}}}}]);